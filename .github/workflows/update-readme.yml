name: Data Fetch

on:
    schedule:
        - cron: "0 8 * * *" # Every day at 1am PDT
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Check out repo
              uses: actions/checkout@v4
              with:
                  token: ${{ secrets.WORKFLOW_PUSH_BOT_TOKEN }}

            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version-file: ".nvmrc"
                  cache: pnpm

            - name: Install corepack@0.31.0 and pnpm
              run: |
                  npm install -g corepack@0.31.0
                  corepack enable pnpm
                  pnpm --version

            - name: Install dependencies
              run: pnpm install --frozen-lockfile

            - name: Update README with latest sponsor data
              run: pnpm run build:readme

            - name: Setup Git
              run: |
                  git config user.name "GitHub Actions Bot"
                  git config user.email "<eslint@googlegroups.com>"
            - name: Save updated files
              run: |
                  chmod +x ./tools/commit-readme.sh
                  ./tools/commit-readme.sh
